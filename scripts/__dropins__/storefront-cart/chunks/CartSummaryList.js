/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as m,Fragment as B}from"@dropins/tools/preact-jsx-runtime.js";import*as A from"@dropins/tools/preact-compat.js";import{useState as O,useCallback as qt,useEffect as wt}from"@dropins/tools/preact-compat.js";import{classes as S,VComponent as z,Slot as p}from"@dropins/tools/lib.js";import{E as Ut}from"./EmptyCart.js";/* empty css                */import{Divider as Pt,Skeleton as jt,SkeletonRow as Tt,InLineAlert as Vt,CartList as Nt,Icon as T,Button as V,Accordion as Jt,AccordionSection as Kt,CartItem as Yt,Price as L,Image as Zt}from"@dropins/tools/components.js";import"@dropins/tools/preact-hooks.js";import{g as Rt}from"./persisted-data.js";import{events as Mt}from"@dropins/tools/event-bus.js";import{s as Dt}from"./resetCart.js";import{u as xt}from"./updateProductsFromCart.js";import{S as At,a as Ht}from"./WarningWithCircle.js";import{S as tn}from"./ChevronDown.js";import{useText as nn}from"@dropins/tools/i18n.js";const rn=C=>A.createElement("svg",{id:"Icon_Chevron_right_Base","data-name":"Icon \\u2013 Chevron right \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...C},A.createElement("g",{id:"Large"},A.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),A.createElement("g",{id:"Chevron_right_icon","data-name":"Chevron right icon"},A.createElement("path",{vectorEffect:"non-scaling-stroke",id:"chevron",d:"M199.75,367.5l4.255,-4.255-4.255,-4.255",transform:"translate(-189.25 -351.0)",fill:"none",stroke:"currentColor"})))),Ot=({className:C,children:J,heading:k,footer:y,emptyCart:w,products:u,outOfStockMessage:g,variant:P="primary",loading:f=!0,...c})=>r("div",{...c,className:S(["cart-cart-summary-list",C,`cart-cart-summary-list__background--${P}`]),children:f?r(en,{}):m(B,{children:[(k||g)&&m("div",{"data-testid":"cart-summary-list-heading-wrapper",className:S(["cart-cart-summary-list__heading",["cart-cart-summary-list__heading--full-width",!u]]),children:[k&&m(B,{children:[r(z,{node:k,className:"cart-cart-summary-list__heading-text"}),r(Pt,{variant:"primary",className:S(["cart-cart-summary-list__heading-divider"])})]}),g&&r(z,{node:g,className:"cart-cart-summary-list__out-of-stock-message"})]}),r("div",{className:S(["cart-cart-summary-list__content",["cart-cart-summary-list__content--empty",!u]]),children:u||r(z,{node:w,className:"cart-cart-summary-list__empty-cart"})}),y&&m(B,{children:[r(Pt,{variant:"primary",className:S(["cart-cart-summary-list__footer-divider"])}),r(z,{node:y,className:"cart-cart-summary-list__footer-text"})]})]})}),en=()=>r(jt,{"data-testid":"cart-summary-list-skeleton",className:"cart-cart-summary-list__skeleton",rowGap:"medium",children:r(Tt,{variant:"row",size:"xlarge",fullWidth:!0,lines:3,multilineGap:"small"})}),an=({initialData:C=null,hideHeading:J,hideFooter:k,routeProduct:y,routeEmptyCartCTA:w,routeCart:u,onItemUpdate:g,onItemRemove:P,maxItems:f,slots:c,attributesToHide:s=[],enableRemoveItem:E,enableUpdateItemQuantity:W,onItemsErrorsChange:q,accordion:Lt=!1,variant:U="primary",isLoading:Et,showMaxItems:K,showDiscount:Y,showSavings:Z,quantityType:R,dropdownOptions:M,...D})=>{var kt;const[Q,Qt]=O(!C),[a,Gt]=O(C),[_,Xt]=O(new Set),[G,H]=O(new Map),o=(kt=Dt.config)==null?void 0:kt.shoppingCartDisplaySetting,[X,$t]=O(K?!0:!f&&!K),i=nn({file:"Cart.CartItem.file",files:"Cart.CartItem.files",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",discountedPrice:"Cart.CartItem.discountedPrice",sender:"Cart.CartItem.sender",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action",notAvailableMessage:"Cart.CartItem.notAvailableMessage",viewMore:"Cart.Cart.viewMore",viewAll:"Cart.Cart.viewAll",discountPercent:"Cart.CartItem.discountPercentage",savingsAmount:"Cart.CartItem.savingsAmount"}),$=(t,n)=>{Xt(e=>(n?e.add(t):e.delete(t),new Set(e)))},tt=(t,n)=>{H(e=>(n?e.set(t,n):e.delete(t),new Map(e)))},j=(t,n)=>{$(t.uid,!0),H(new Map),E&&n===0?xt([{uid:t.uid,quantity:n}]).then(()=>{P==null||P({item:t})}).finally(()=>{$(t.uid,!1)}).catch(e=>{console.warn(e)}):W&&xt([{uid:t.uid,quantity:n}]).then(()=>{g==null||g({item:t})}).finally(()=>{$(t.uid,!1)}).catch(e=>{tt(t.uid,e.message)})},bt=qt(()=>{$t(t=>!t)},[]);wt(()=>{const t=Mt.on("cart/data",n=>{Gt(n),Qt(!!Et)},{eager:!0});return()=>{t==null||t.off()}},[]),wt(()=>{q&&q(G)},[G,q]);const nt=(t,n)=>{if(s.includes("image"))return;const e={loading:n<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}},l=r(Zt,{"data-testid":"cart-list-item-image",...e});return r(p,{name:"Thumbnail",slot:c==null?void 0:c.Thumbnail,context:{item:t,defaultImageProps:e},children:y?r("a",{href:y(t),children:l}):l})},rt=t=>{if(!s.includes("name"))return r("span",{"data-testid":"cart-list-item-title",children:y?r("a",{href:y(t),children:t.name}):t.name})},et=t=>{if(s.includes("configurations"))return;const n={...t.bundleOptions,...t.selectedOptions,...t.customizableOptions,...t.recipient?{[i.recipient]:t.recipient}:null,...t.recipientEmail&&t.recipient?{[i.recipient]:`${t.recipient} (${t.recipientEmail})`}:null,...t.sender?{[i.sender]:t.sender}:null,...t.senderEmail&&t.sender?{[i.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[i.message]:t.message}:null,...t.links&&t.links.count?t.links.count>1?{[i.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[i.file.replace("{count}",t.links.count.toString())]:t.links.result}:null};if(Object.keys(n).length!==0)return n},at=t=>{var n,e,l,d;return(o==null?void 0:o.price)==="INCLUDING_TAX"?t.discounted?{amount:t.regularPrice.value,currency:t.regularPrice.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(n=t.taxedPrice)==null?void 0:n.value,currency:(e=t.taxedPrice)==null?void 0:e.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(l=t.regularPrice)==null?void 0:l.value,currency:(d=t.regularPrice)==null?void 0:d.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}},it=t=>{var n,e;return{amount:(n=t.savingsAmount)==null?void 0:n.value,currency:(e=t.savingsAmount)==null?void 0:e.currency,style:{font:"inherit"},"data-testid":"item-savings-amount"}},ct=t=>(o==null?void 0:o.price)==="INCLUDING_EXCLUDING_TAX"?r(L,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":i.regularPrice}):void 0,ot=t=>{var l,d,I,h,v,N,x,_t,It,St;const n={"aria-label":i.regularPrice},e=t.discounted?{}:null;return["INCLUDING_TAX","INCLUDING_EXCLUDING_TAX"].includes(o==null?void 0:o.price)?(n.amount=(l=t.rowTotalIncludingTax)==null?void 0:l.value,n.currency=(d=t.rowTotalIncludingTax)==null?void 0:d.currency,n.variant=t.discounted?"strikethrough":"default",n["data-testid"]="including-tax-item-total",e&&(n.amount=(I=t.total)==null?void 0:I.value,n.currency=(h=t.total)==null?void 0:h.currency,e.amount=(v=t.rowTotalIncludingTax)==null?void 0:v.value,e.currency=(N=t.rowTotalIncludingTax)==null?void 0:N.currency,e.sale=!0,e["aria-label"]=i.discountedPrice,e["data-testid"]="discount-total")):(n.amount=(x=t.total)==null?void 0:x.value,n.currency=(_t=t.total)==null?void 0:_t.currency,n.variant=t.discounted?"strikethrough":"default",n["data-testid"]="regular-item-total",e&&(e.amount=(It=t.discountedTotal)==null?void 0:It.value,e.currency=(St=t.discountedTotal)==null?void 0:St.currency,e.sale=!0,e["aria-label"]=i.regularPrice,e["data-testid"]="discount-total")),{totalProps:n,discountProps:e}},st=t=>{var v,N,x;if(s.includes("warning"))return;const n=G.get(t.uid),e=(v=G.get(t.uid))==null?void 0:v.includes("The requested qty is not available"),l=_.has(t.uid),d=t.insufficientQuantity&&t.stockLevel?t.stockLevel==="noNumber"?i.insufficientQuantityGeneral:i.insufficientQuantity.replace("{inventory}",(N=t.stockLevel)==null?void 0:N.toString()).replace("{count}",t.quantity.toString()):"",I=t.lowInventory&&t.onlyXLeftInStock&&i.lowInventory.replace("{count}",(x=t.onlyXLeftInStock)==null?void 0:x.toString()),h=!t.outOfStock&&n&&e?i.notAvailableMessage:n;return!l&&(n||t.insufficientQuantity||t.lowInventory)?m("span",{"data-testid":"item-warning",children:[r(T,{source:Ht,size:"16"}),h||d||I]}):void 0},lt=t=>s!=null&&s.includes("alert")?void 0:!_.has(t.uid)&&t.outOfStock?m("span",{"data-testid":"item-alert",children:[r(T,{source:At,size:"16"}),i.outOfStockAlert]}):void 0,ut=t=>r(p,{name:"ProductAttributes",slot:c==null?void 0:c.ProductAttributes,context:{item:t}}),dt=t=>{if(!s.includes("sku"))return r("span",{"data-testid":"cart-list-item-sku",children:t.sku})},gt=t=>r(p,{name:"Footer",slot:c==null?void 0:c.Footer,context:{item:t,handleItemsLoading:$,handleItemsError:tt,onItemUpdate:g}}),ft=t=>a!=null&&a.totalQuantity?a.items.filter(t).map((n,e)=>{var h;const{totalProps:l,discountProps:d}=ot(n),I=r(Yt,{updating:_==null?void 0:_.has(n.uid),loading:Q,"data-testid":`cart-list-item-entry-${n.uid}`,image:nt(n,e),title:rt(n),sku:dt(n),price:s.includes("price")?void 0:r(L,{...at(n)}),quantity:s.includes("quantity")?void 0:n.quantity,total:m(B,{children:[s.includes("total")?void 0:r(L,{...l}),s.includes("totalDiscount")?void 0:d&&r(L,{...d})]}),attributes:ut(n),configurations:et(n),totalExcludingTax:s.includes("totalExcludingTax")?void 0:ct(n),taxIncluded:(o==null?void 0:o.price)==="INCLUDING_TAX",taxExcluded:!s.includes("totalExcludingTax")&&(o==null?void 0:o.price)==="INCLUDING_EXCLUDING_TAX",warning:st(n),alert:lt(n),quantityType:R,dropdownOptions:M,onQuantity:W?v=>{j(n,v)}:void 0,onRemove:E?()=>j(n,0):void 0,discount:Y&&n.discounted&&n.discountPercentage?r("div",{"data-testid":"item-discount-percent",children:i.discountPercent.replace("{discount}",((h=n.discountPercentage)==null?void 0:h.toString())??"")}):void 0,savings:Z&&n.discounted&&n.savingsAmount?m("div",{children:[r("span",{children:r(L,{...it(n)})})," ",i.savingsAmount]}):void 0,footer:gt(n)},n.uid);return r(p,{name:"CartItem",slot:c==null?void 0:c.CartItem,context:{item:n,index:e,enableUpdateItemQuantity:W,enableRemoveItem:E,itemsLoading:_,loading:Q,attributesToHide:s,cartTaxesConfig:o,quantityType:R,dropdownOptions:M,showDiscount:Y,showSavings:Z,dictionary:i,getImage:nt,getTitle:rt,getSku:dt,getPriceProps:at,getTotalPriceProps:ot,getProductAttributes:ut,getConfiguration:et,getTotalExcludingTax:ct,getWarning:st,getAlert:lt,getFooter:gt,getSavingsAmount:it},children:I},n.uid)}):null,mt=r(p,{name:"EmptyCart",slot:c==null?void 0:c.EmptyCart,context:{},children:r(Ut,{"data-testid":"empty-cart",ctaLinkURL:w==null?void 0:w()})}),yt=r(p,{name:"Heading",slot:c==null?void 0:c.Heading,context:{count:a==null?void 0:a.totalQuantity},children:r("div",{"data-testid":"default-cart-heading",children:i.heading.replace("({count})",a!=null&&a.totalQuantity?`(${a==null?void 0:a.totalQuantity.toString()})`:"")})}),Ft=yt.props.children.props.children,zt=()=>{const t=a==null?void 0:a.items.filter(n=>n.outOfStock);t==null||t.forEach(n=>{j(n,0)})},Bt=ft(t=>t.outOfStock||t.insufficientQuantity||!1),ht=a!=null&&a.hasOutOfStockItems?r(Vt,{"data-testid":"cart-out-of-stock-message",icon:r(T,{source:At,size:"16"}),itemList:r(Nt,{"data-testid":"out-of-stock-cart-items",children:Bt}),type:"warning",heading:i.outOfStockHeading,description:i.outOfStockDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:a!=null&&a.hasFullyOutOfStockItems&&E?[{label:i.removeAction,onClick:zt}]:void 0}):void 0,b=ft(t=>!t.outOfStock&&!t.insufficientQuantity),vt=X?Math.max(f||5,5):Math.min((a==null?void 0:a.totalQuantity)||5,5),pt=(a==null?void 0:a.totalQuantity)>vt,Wt=pt&&!X&&vt!=f,F=a!=null&&a.totalQuantity&&b?r(p,{name:"Footer",slot:c==null?void 0:c.CartSummaryFooter,context:{displayMaxItems:X,routeCart:u},"data-testid":"cart-cart-summary-footer-slot",className:"cart-cart-summary-footer",children:pt?Wt?r(V,{className:"cart-cart-summary-list-footer__action",onClick:bt,"data-testid":"view-more-items-button",variant:"tertiary",children:i.viewMore}):u&&r(V,{className:"cart-cart-summary-list-footer__action",href:u(),variant:"tertiary","data-testid":"view-cart-or-less-items-button",children:i.viewAll}):u&&r(V,{className:"cart-cart-summary-list-footer__action",href:u(),variant:"tertiary","data-testid":"view-cart-button",children:i.viewAll})}):null,Ct=a!=null&&a.totalQuantity?r(Nt,{"data-testid":"cart-list",children:b==null?void 0:b.slice(0,X?Math.max(f||(a==null?void 0:a.totalQuantity),5):Math.min(f??5,5))}):null;return Lt?r(Jt,{"data-testid":"cart-summary-list-accordion",className:S(["cart-cart-summary-list-accordion",`cart-cart-summary-list__background--${U}`]),iconOpen:rn,iconClose:tn,children:r(Kt,{title:Ft,"data-testid":"cart-summary-list-accordion__section",open:!0,renderContentWhenClosed:!0,children:r(Ot,{...D,"aria-expanded":!0,"aria-label":"TEST",className:"cart-cart-summary-list-accordion__list",loading:Q,footer:k?void 0:F||(u?F:void 0),emptyCart:mt,products:Ct,outOfStockMessage:ht,variant:U})})}):r(Ot,{...D,heading:J?void 0:yt,footer:k?void 0:F||(u?F:void 0),loading:Q,emptyCart:mt,products:Ct,outOfStockMessage:ht,variant:U})};an.getInitialData=async function(){return Rt()};export{an as C};
//# sourceMappingURL=CartSummaryList.js.map
