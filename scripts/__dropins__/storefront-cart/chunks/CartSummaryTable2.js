/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as o,jsx as r}from"@dropins/tools/preact-jsx-runtime.js";import{classes as W,VComponent as _,debounce as fa,Slot as h}from"@dropins/tools/lib.js";import{Image as Ca,Icon as H,Button as Ia,Price as k,Skeleton as va,SkeletonRow as xa}from"@dropins/tools/components.js";/* empty css                */import*as S from"@dropins/tools/preact-compat.js";import{useState as la,useCallback as Na,useMemo as ka}from"@dropins/tools/preact-compat.js";import{useState as ua,useEffect as wa,useMemo as Ta}from"@dropins/tools/preact-hooks.js";import{useText as oa}from"@dropins/tools/i18n.js";import{events as Sa}from"@dropins/tools/event-bus.js";import{s as Pa}from"./resetCart.js";import{u as sa}from"./updateProductsFromCart.js";import{g as Ma}from"./persisted-data.js";import{S as qa,a as La}from"./WarningWithCircle.js";const Oa=l=>S.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...l},S.createElement("path",{d:"M1 5H23",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),S.createElement("path",{d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),S.createElement("path",{d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),S.createElement("path",{d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),S.createElement("path",{d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),Ea=({entries:l,className:d,...e})=>{const m=oa({itemLabel:"Cart.CartSummaryTable.item",priceLabel:"Cart.CartSummaryTable.price",qtyLabel:"Cart.CartSummaryTable.qty",subtotalLabel:"Cart.CartSummaryTable.subtotal",mobilePriceLabel:"Cart.CartSummaryTable.mobilePrice",mobileQtyLabel:"Cart.CartSummaryTable.mobileQty",mobileSubtotalLabel:"Cart.CartSummaryTable.mobileSubtotal"});return o("div",{...e,className:W(["cart-cart-summary-table",d]),children:[o("div",{className:"cart-cart-summary-table__header",children:[r("div",{className:"cart-cart-summary-table__header-item",children:m.itemLabel}),r("div",{className:"cart-cart-summary-table__header-price",children:m.priceLabel}),r("div",{className:"cart-cart-summary-table__header-qty",children:m.qtyLabel}),r("div",{className:"cart-cart-summary-table__header-subtotal",children:m.subtotalLabel})]}),r("div",{className:"cart-cart-summary-table__body",children:l.map(u=>o("div",{className:W(["cart-cart-summary-table__row",["cart-cart-summary-table__row--updating",u.updating],["cart-cart-summary-table__row--error",u.hasError]]),children:[r("div",{className:"cart-cart-summary-table__cell-item",children:r(_,{node:u.item})}),o("div",{className:"cart-cart-summary-table__cell-price",children:[r("span",{className:"cart-cart-summary-table__mobile-label",children:m.mobilePriceLabel}),r(_,{node:u.price})]}),o("div",{className:"cart-cart-summary-table__cell-qty",children:[r("span",{className:"cart-cart-summary-table__mobile-label",children:m.mobileQtyLabel}),r(_,{node:u.quantity})]}),o("div",{className:"cart-cart-summary-table__cell-subtotal",children:[r("span",{className:"cart-cart-summary-table__mobile-label",children:m.mobileSubtotalLabel}),r(_,{node:u.subtotal})]}),r("div",{className:"cart-cart-summary-table__item-footer",children:r(_,{className:"cart-cart-summary-table__item-actions",node:u.actions})})]},u.uid))})]})},Aa=({className:l,productTitle:d,sku:e,image:m,configurations:u,alert:I,warning:v,...g})=>o("div",{...g,className:W(["cart-cart-summary-table__item",l]),children:[m&&r(_,{className:"cart-cart-summary-table__item-image-wrapper",node:m}),o("div",{className:"cart-cart-summary-table__item-details",children:[d&&r(_,{className:"cart-cart-summary-table__item-name",node:d}),e&&r(_,{className:"cart-cart-summary-table__sku",node:e}),I&&r(_,{className:"cart-cart-summary-table__item-quantity-alert-text",node:I}),v&&r(_,{className:"cart-cart-summary-table__item-quantity-warning-text",node:v}),u&&r(_,{className:"cart-cart-summary-table__item-configurations",node:u})]})]}),Ua=({dictionary:l,onQuantityUpdate:d,onItemRemove:e})=>{var L,O;const[m,u]=la(new Map),[I,v]=la(new Map),g=(O=(L=Pa)==null?void 0:L.config)==null?void 0:O.shoppingCartDisplaySetting,U=(g==null?void 0:g.price)==="INCLUDING_TAX",G=(g==null?void 0:g.price)==="INCLUDING_EXCLUDING_TAX",P=({item:a})=>{const n={...a.bundleOptions,...a.selectedOptions,...a.customizableOptions,...a.recipient?{[l.recipient]:a.recipient}:null,...a.recipientEmail&&a.recipient?{[l.recipient]:`${a.recipient} (${a.recipientEmail})`}:null,...a.sender?{[l.sender]:a.sender}:null,...a.senderEmail&&a.sender?{[l.sender]:`${a.sender} (${a.senderEmail})`}:{},...a.message?{[l.message]:a.message}:null,...a.links&&a.links.count?a.links.count>1?{[l.files.replace("{count}",a.links.count.toString())]:a.links.result}:{[l.file.replace("{count}",a.links.count.toString())]:a.links.result}:null};if(Object.keys(n).length!==0)return n},w=a=>{var n,c,i,s;return U?a.discounted?{amount:a.regularPrice.value,currency:a.regularPrice.currency,"data-testid":"discounted-regular-item-price"}:{amount:(n=a.taxedPrice)==null?void 0:n.value,currency:(c=a.taxedPrice)==null?void 0:c.currency,"data-testid":"taxed-item-price"}:{amount:(i=a.regularPrice)==null?void 0:i.value,currency:(s=a.regularPrice)==null?void 0:s.currency,"data-testid":"regular-item-price"}},D=a=>{var i,s,b,C,t,y,x,T,$,E;const n={"aria-label":l.regularPrice},c=a.discounted?{}:null;return["INCLUDING_TAX","INCLUDING_EXCLUDING_TAX"].includes(g==null?void 0:g.price)?(n.amount=(i=a.rowTotalIncludingTax)==null?void 0:i.value,n.currency=(s=a.rowTotalIncludingTax)==null?void 0:s.currency,n.variant=a.discounted?"strikethrough":"default",n["data-testid"]="including-tax-item-total",c&&(n.amount=(b=a.total)==null?void 0:b.value,n.currency=(C=a.total)==null?void 0:C.currency,c.amount=(t=a.rowTotalIncludingTax)==null?void 0:t.value,c.currency=(y=a.rowTotalIncludingTax)==null?void 0:y.currency,c.sale=!0,c["aria-label"]=l.discountedPrice,c["data-testid"]="discount-total")):(n.amount=(x=a.total)==null?void 0:x.value,n.currency=(T=a.total)==null?void 0:T.currency,n.variant=a.discounted?"strikethrough":"default",n["data-testid"]="regular-item-total",c&&(c.amount=($=a.discountedTotal)==null?void 0:$.value,c.currency=(E=a.discountedTotal)==null?void 0:E.currency,c.sale=!0,c["aria-label"]=l.regularPrice,c["data-testid"]="discount-total")),{subtotalProps:n,subtotalDiscountProps:c}},p=a=>{var s,b;const n=I.get(a.uid),c=a.insufficientQuantity&&a.stockLevel?a.stockLevel==="noNumber"?l.insufficientQuantityGeneral:l.insufficientQuantity.replace("{inventory}",(s=a.stockLevel)==null?void 0:s.toString()).replace("{count}",a.quantity.toString()):void 0,i=a.lowInventory&&a.onlyXLeftInStock&&l.lowInventory.replace("{count}",(b=a.onlyXLeftInStock)==null?void 0:b.toString());return n||c||i||void 0},N=Na(async(a,n)=>{const c=(i,s)=>sa([{uid:i.uid,quantity:s}]);if(!(isNaN(n)||a.quantity===n)){v(new Map);try{u(i=>{const s=new Map(i);return s.set(a.uid,{isUpdating:!0,updatedValue:n}),s}),await c(a,n),n===0?e==null||e(a):d==null||d(a,n)}catch(i){u(s=>{const b=new Map(s);return b.delete(a.uid),b}),v(s=>{const b=new Map(s);return b.set(a.uid,i.message),b})}}},[e,d]),M=ka(()=>fa(N,500),[N]);return{showIncludedTaxPrice:U,showExcludingTaxPrice:G,itemsUpdating:m,itemUpdateErrors:I,getConfiguration:P,getPriceProps:w,getSubtotalProps:D,processQuantityChange:N,debouncedQuantityChange:M,setItemsUpdating:u,getWarningMessage:p,setItemUpdateError:(a,n)=>{v(c=>{const i=new Map(c);return n?i.set(a,n):i.delete(a),i})},handleRemoveItem:a=>(u(n=>{const c=new Map(n);return c.set(a.uid,{isUpdating:!0,updatedValue:0}),c}),sa([{uid:a.uid,quantity:0}]).then(n=>(e==null||e(a),Promise.resolve(n)))),setItemUpdating:(a,n)=>{u(c=>{const i=new Map(c);return i.set(a,{isUpdating:n,updatedValue:n}),i})}}},Da=()=>r(va,{"data-testid":"cart-summary-table-skeleton",className:"cart-cart-summary-table__skeleton",rowGap:"medium",children:r(xa,{variant:"row",size:"xlarge",fullWidth:!0,lines:4,multilineGap:"small"})}),$a=({initialData:l=null,routeProduct:d,slots:e,className:m,allowQuantityUpdates:u=!0,allowRemoveItems:I=!0,onQuantityUpdate:v,onItemRemove:g,...U})=>{const[G,P]=ua(!l),[w,D]=ua(l),p=oa({file:"Cart.CartItem.file",files:"Cart.CartItem.files",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",discountedPrice:"Cart.CartItem.discountedPrice",sender:"Cart.CartItem.sender",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action",notAvailableMessage:"Cart.CartItem.notAvailableMessage",viewMore:"Cart.Cart.viewMore",viewAll:"Cart.Cart.viewAll",discountPercent:"Cart.CartItem.discountPercentage",savingsAmount:"Cart.CartItem.savingsAmount",includingTax:"Cart.CartItem.includingTax",excludingTax:"Cart.CartItem.excludingTax",remove:"Dropin.CartItem.remove.label",removeDefault:"Dropin.CartItem.removeDefault.label",quantity:"Dropin.CartItem.quantity.label"}),{showIncludedTaxPrice:N,showExcludingTaxPrice:M,itemsUpdating:q,itemUpdateErrors:f,getConfiguration:Q,getPriceProps:V,getSubtotalProps:L,debouncedQuantityChange:O,setItemsUpdating:a,getWarningMessage:n,handleRemoveItem:c,setItemUpdating:i,setItemUpdateError:s}=Ua({dictionary:p,onQuantityUpdate:v,onItemRemove:g});wa(()=>{const C=Sa.on("cart/data",t=>{P(!0),D(t),a(new Map),P(!1)},{eager:!0});return()=>{C==null||C.off()}},[P,D,a]);const b=Ta(()=>{var C;return((C=w==null?void 0:w.items)==null?void 0:C.sort((t,y)=>f.has(t.uid)&&!f.has(y.uid)?-1:!f.has(t.uid)&&f.has(y.uid)?1:t.outOfStock&&!y.outOfStock?-1:!t.outOfStock&&y.outOfStock?1:0).map((t,y)=>{var K,Y,R,aa,ta,ea,ra,na,ca,ia;const x=q.has(t.uid),T=n(t),$=r(h,{name:"ProductTitle",slot:e==null?void 0:e.ProductTitle,context:{item:t},children:d?r("a",{href:d(t),children:t.name}):t.name}),E={src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}},j=r(Ca,{"data-testid":`cart-table-item-image-${t.sku}`,loading:y<4?"eager":"lazy",...E}),da=r(h,{name:"Thumbnail",slot:e==null?void 0:e.Thumbnail,className:"cart-cart-summary-table__item-image-wrapper",context:{item:t,defaultImageProps:{...E,loading:y<4?"eager":"lazy"},index:y},children:d?r("a",{href:d(t),children:j}):j}),ma=r(h,{name:"Sku",slot:e==null?void 0:e.Sku,context:{item:t},children:t.sku}),ga=t.outOfStock||e!=null&&e.ItemAlert?r(h,{name:"ItemAlert",slot:e==null?void 0:e.ItemAlert,context:{item:t},children:t.outOfStock&&o("div",{className:"cart-cart-summary-table__item-quantity-alert-wrapper","data-testid":`cart-table-item-quantity-alert-${t.uid}`,children:[r(H,{className:"cart-cart-summary-table__item-quantity-alert-icon",source:qa,size:"16"}),r("span",{className:"cart-cart-summary-table__item-quantity-alert-text",children:p.outOfStockAlert})]})}):void 0,ba=T||e!=null&&e.ItemWarning?r(h,{name:"ItemWarning",slot:e==null?void 0:e.ItemWarning,context:{item:t},children:T&&o("div",{className:"cart-cart-summary-table__item-quantity-warning-wrapper","data-testid":`cart-table-item-quantity-warning-${t.uid}`,children:[r(H,{className:"cart-cart-summary-table__item-quantity-warning-icon",source:La,size:"16"}),r("span",{className:"cart-cart-summary-table__item-quantity-warning-text",children:T})]})}):void 0,z=Q({item:t}),pa=z||e!=null&&e.Configurations?r(h,{name:"Configurations",slot:e==null?void 0:e.Configurations,context:{item:t},children:z&&r("ul",{className:"cart-cart-summary-table__item-configurations","data-testid":`cart-table-item-configurations-${t.sku}`,children:Object.entries(z).map(([A,X])=>o("li",{className:"cart-cart-summary-table__item-configuration","data-testid":`cart-table-item-configuration-${A}`,children:[o("span",{className:"cart-cart-summary-table__item-configuration-label",children:[A,":"]}),r("span",{className:"cart-cart-summary-table__item-configuration-value",children:X})]},A))})}):void 0,{subtotalProps:ya,subtotalDiscountProps:B}=L(t),Z=(K=q.get(t.uid))==null?void 0:K.updatedValue,F=x&&!isNaN(Z)?Z:t.quantity,J=A=>{const X=A.target,_a=parseInt(X.value,10);O(t,_a)},ha=r(h,{name:"Actions",slot:e==null?void 0:e.Actions,context:{item:t,itemsUpdating:q,setItemUpdating:i,setItemUpdateError:s},children:I&&r(Ia,{variant:"tertiary",size:"medium",className:"cart-cart-summary-table__item-remove-button","data-testid":`cart-table-item-remove-${t.uid}`,icon:r(H,{source:Oa,size:"32"}),onClick:()=>c(t),"aria-label":((Y=p.remove)==null?void 0:Y.replace("{product}",t.name))||p.removeDefault})});return{key:t.uid,uid:t.uid,updating:x,hasError:t.outOfStock||f.has(t.uid),item:r(h,{name:"Item",slot:e==null?void 0:e.Item,context:{item:t},children:r(Aa,{productTitle:$,image:da,sku:ma,configurations:pa,alert:ga,warning:ba})}),price:o(h,{name:"Price",className:"cart-cart-summary-table__item-price",slot:e==null?void 0:e.Price,context:{item:t},children:[r(k,{...V(t)}),N&&o("span",{className:"cart-cart-summary-table__item-price-tax-label",children:[p.includingTax,": ",r(k,{amount:(R=t.taxedPrice)==null?void 0:R.value,currency:(aa=t.taxedPrice)==null?void 0:aa.currency})]}),M&&o("span",{className:"cart-cart-summary-table__item-price-tax-label",children:[p.excludingTax,": ",r(k,{amount:(ta=t.regularPrice)==null?void 0:ta.value,currency:(ea=t.regularPrice)==null?void 0:ea.currency})]})]}),quantity:r(h,{name:"Quantity",className:"cart-cart-summary-table__item-qty",slot:e==null?void 0:e.Quantity,context:{item:t,isUpdating:x,quantityInputValue:F,handleInputChange:J,itemUpdateErrors:f},children:u?r("input",{id:`cart-table-item-quantity-${t.uid}`,"data-testid":`cart-table-item-quantity-${t.uid}`,type:"number",min:"1",value:F,disabled:x,"aria-label":p.quantity,className:W(["cart-cart-summary-table__cell-qty-input","cart-cart-summary-table__cell-qty-updater",["cart-cart-summary-table__cell-qty-updater--disabled",x],["cart-cart-summary-table__cell-qty-updater--error",f.has(t.uid)]]),onChange:J}):r("span",{children:t.quantity})}),subtotal:o(h,{name:"Subtotal",className:"cart-cart-summary-table__item-subtotal",slot:e==null?void 0:e.Subtotal,context:{item:t},children:[r(k,{...ya}),B&&r(k,{...B}),N&&o("span",{className:"cart-cart-summary-table__item-subtotal-tax-label",children:[p.includingTax,": ",r(k,{amount:(ra=t.rowTotalIncludingTax)==null?void 0:ra.value,currency:(na=t.rowTotalIncludingTax)==null?void 0:na.currency})]}),M&&o("span",{className:"cart-cart-summary-table__item-subtotal-tax-label",children:[p.excludingTax,": ",r(k,{amount:(ca=t.rowTotal)==null?void 0:ca.value,currency:(ia=t.rowTotal)==null?void 0:ia.currency})]})]}),actions:ha}}))||[]},[w,q,u,d,e,f,p,Q,I,O,n,V,L,c,i,s,N,M]);return G?r(Da,{}):r(Ea,{entries:b,className:m,...U})};$a.getInitialData=async function(){return Ma()};export{$a as C};
//# sourceMappingURL=CartSummaryTable2.js.map
