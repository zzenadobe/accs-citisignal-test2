/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as X,Fragment as O}from"@dropins/tools/preact-jsx-runtime.js";import{useState as k,useRef as $,useCallback as H,useEffect as b}from"@dropins/tools/preact-compat.js";import{ContentGrid as J,Skeleton as K,SkeletonRow as Q,ProductItemCard as Y,Button as Z,Price as D,Image as ee}from"@dropins/tools/components.js";import{classes as te,VComponent as ne,Slot as v}from"@dropins/tools/lib.js";import{events as oe}from"@dropins/tools/event-bus.js";import{t as L,s as B,p as I,R as S,a as re,b as ie,g as ce}from"../chunks/events.js";import{useText as ae}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const de=({className:c,children:m,heading:h,products:i=null,loading:f=!0,...R})=>t("div",{...R,className:te(["recommendations-product-list",c,["recommendations-product-list--empty",!i]]),children:f?t(se,{}):X(O,{children:[h&&t(ne,{node:h,className:"recommendations-product-list__heading"}),t(J,{className:"recommendations-product-list__content","data-testid":"recommendations-product-list__content",maxColumns:0,columnWidth:"minmax(240px, 1fr)",children:i})]})}),se=()=>t(K,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((c,m)=>t(Q,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},m))}),le=c=>{const{recommendationUnit:m,...h}=c,i=L(m,h);B(S,{units:[i]}),I(ie)},me=c=>{const{recommendationUnit:m,...h}=c,i=L(m,h);B(S,{units:[i]}),I(re)},xe=({recId:c,initialData:m=null,hideHeading:h,routeProduct:i,currentSku:f,cartSkus:R,userPurchaseHistory:P,userViewHistory:E,slots:n,...F})=>{var U,N,_;const[z,T]=k(!m),[o,w]=k((U=m==null?void 0:m.recommendations)!=null&&U.results?m.recommendations.results.filter(e=>e.unitId===c):[]),g=$(null),x=ae({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),C=H(()=>!!c&&!!f,[c,f]);if(b(()=>{const e=oe.on("recommendations/data",a=>{a&&a.length>0&&w(d=>{const r=d||[],s=a.filter(l=>{var u;return((u=l==null?void 0:l.items)==null?void 0:u.length)&&!r.some(p=>p.unitId===l.unitId)});return s.forEach(l=>{var u,p;le({recommendationUnit:l,pagePlacement:"product-list",yOffsetTop:((u=g.current)==null?void 0:u.getBoundingClientRect().top)??0,yOffsetBottom:((p=g.current)==null?void 0:p.getBoundingClientRect().bottom)??0,backupProducts:0,searchTime:0})}),[...r,...s]}),T(!1)});return()=>{e==null||e.off()}},[c]),b(()=>{if(!(o!=null&&o.length)||!g.current)return;const e={root:null,rootMargin:"0px",threshold:.5},a=r=>{r.forEach(s=>{s.intersectionRatio>.5&&o.forEach(l=>{var u,p;me({recommendationUnit:l,pagePlacement:"product-list",yOffsetTop:((u=g.current)==null?void 0:u.getBoundingClientRect().top)??0,yOffsetBottom:((p=g.current)==null?void 0:p.getBoundingClientRect().bottom)??0})})})},d=new IntersectionObserver(a,e);return d.observe(g.current),()=>d.disconnect()},[o]),b(()=>{if(!C()){T(!1);return}T(!0),ce({currentSku:f,pageType:"Product",cartSkus:R,userPurchaseHistory:P,userViewHistory:E,recId:c}).catch(e=>{console.error("Recommendations error:",e),w([]),T(!1)})},[f,R,P,E,C,c]),!C())return c||console.warn("ProductList: recId is missing. Please provide a valid recId to display product recommendations."),f||console.warn("ProductList: currentSku is missing. Please provide a valid currentSku to display product recommendations."),null;const G=(e,a)=>{var s,l,u,p;const d={loading:a<4?"eager":"lazy",src:((l=(s=e.images)==null?void 0:s[0])==null?void 0:l.url)||"",alt:((p=(u=e.images)==null?void 0:u[0])==null?void 0:p.label)||"",width:"300",height:"300",params:{width:300}},r=t(ee,{"data-testid":"product-list-item-image",...d,"aria-label":e.sku});return t(v,{name:"Thumbnail",slot:n==null?void 0:n.Thumbnail,context:{item:e,defaultImageProps:d},children:i?t("a",{href:i(e),children:r}):r})},M=t(v,{name:"Heading",slot:n==null?void 0:n.Heading,context:{},children:t("div",{"data-testid":"default-product-list-heading",children:((N=o==null?void 0:o[0])==null?void 0:N.title)||x.heading})}),W=(e,a)=>t(v,{name:"Footer",slot:n==null?void 0:n.Footer,context:{item:e,index:a},children:t("div",{"data-testid":"default-product-list-footer",children:i&&t("a",{href:i(e),children:t(Z,{"data-testid":"default-product-list-footer-button",children:x.viewProductText,"aria-label":x.viewProductText,variant:"primary"})})})}),j=e=>t(v,{name:"Title",slot:n==null?void 0:n.Title,context:{item:e,productUrl:i?i(e):""},children:i?t("a",{href:i(e),children:e.name}):t("span",{children:e.name})}),A=e=>t(v,{name:"Sku",slot:n==null?void 0:n.Sku,context:{item:e},children:t("span",{children:e.sku})}),V=e=>{var a,d,r,s;return t(v,{name:"Price",slot:n==null?void 0:n.Price,context:{item:e},children:t("div",{"data-testid":"default-product-price",children:t(D,{amount:((d=(a=e.price.final)==null?void 0:a.amount)==null?void 0:d.value)??void 0,currency:((s=(r=e.price.final)==null?void 0:r.amount)==null?void 0:s.currency)??void 0})})})},q=(_=o==null?void 0:o[0])!=null&&_.totalProducts?t(O,{children:o==null?void 0:o.map(({items:e,totalProducts:a},d)=>a>0?e.map((r,s)=>{const{sku:l}=r;return t(Y,{"data-testid":"recommendations-product-item-card",initialized:!0,sku:A(r),image:G(r,d*e.length+s),titleNode:j(r),price:V(r),actionButton:W(r,d*e.length+s)},l)}):null)}):null,y=!o||o.length===0||o.every(e=>!e.items||e.items.length===0);return t("div",{ref:g,children:t(de,{...F,className:y?"recommendations-product-list--empty":"",heading:h?void 0:M,loading:z,products:y?null:q})})};export{xe as ProductList,xe as default};
//# sourceMappingURL=ProductList.js.map
