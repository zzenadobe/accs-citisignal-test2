/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as o,jsxs as N}from"@dropins/tools/preact-jsx-runtime.js";import*as P from"@dropins/tools/preact-compat.js";import{useState as S,useCallback as pe,useEffect as ge}from"@dropins/tools/preact-compat.js";import{classes as _,VComponent as p,Slot as C}from"@dropins/tools/lib.js";import{Skeleton as Se,SkeletonRow as D,InLineAlert as _e,Icon as Pe,Pagination as we,Picker as Le,PriceRange as v,Image as Ce}from"@dropins/tools/components.js";import{p as ke}from"../chunks/productSearch.js";import{a as ye,b as Ee,c as xe}from"../chunks/api.js";import{u as Re,P as w,a as Ne,b as Ae,c as Ie,d as De,e as Ue,s as qe}from"../chunks/acdlEvents.js";import{a as ze}from"../chunks/attributeMetadata.js";/* empty css                 *//* empty css                   *//* empty css                      *//* empty css                   */import{events as $}from"@dropins/tools/event-bus.js";import{useText as Fe,Text as He}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const $e=t=>P.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},P.createElement("g",{clipPath:"url(#clip0_841_1324)"},P.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),P.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),P.createElement("defs",null,P.createElement("clipPath",{id:"clip0_841_1324"},P.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),Me=()=>o("div",{className:"dropin-product-item-card dropin-product-item-card-skeleton",children:N(Se,{className:"dropin-product-item-card__skeleton dropin-product-item-card__image-container",children:[o(D,{fullWidth:!0,className:"dropin-product-item-card__skeleton__image"}),N("div",{className:"dropin-product-item-card__content dropin-product-item-card__skeleton__content",children:[o(D,{fullWidth:!0,size:"large",className:"dropin-product-item-card__skeleton__item"}),o(D,{fullWidth:!0,size:"xsmall",className:"dropin-product-item-card__skeleton__item"}),o(D,{fullWidth:!0,size:"small",className:"dropin-product-item-card__skeleton__item"})]})," "]})}),ve=({className:t,image:r,titleNode:n,price:d,sku:i,actionButton:a,swatches:l,initialized:u=!1,...A})=>u?N("div",{...A,className:_(["dropin-product-item-card",t]),children:[o("div",{className:"dropin-product-item-card__image-container",children:r&&o(p,{node:r,className:_(["dropin-product-item-card__image"])})}),N("div",{className:"dropin-product-item-card__content",children:[n&&o(p,{node:n,className:_(["dropin-product-item-card__title"])}),i&&o(p,{node:i,className:_(["dropin-product-item-card__sku"])}),d&&o("div",{className:"dropin-product-item-card__price",children:o(p,{node:d,className:_(["dropin-product-item-card__price"])})}),l&&o("div",{className:"dropin-product-item-card__swatches",children:o(p,{node:l,className:_(["dropin-product-item-card__swatches"])})}),a&&o("div",{className:"dropin-product-item-card__action",children:o(p,{node:a,className:_(["dropin-product-item-card__action"])})})]})]}):o(Me,{});function Oe(t){var i;let r="";try{r=self.crypto.randomUUID(),Re(w,r,t.phrase||"",t.filter||[],t.pageSize||0,t.currentPage||0,t.sort||[]),Ne(w)}catch(a){console.error("Error collecting data:",a)}const n={attribute:"visibility",in:["Search","Catalog, Search"]},d=structuredClone(t);return(i=d.filter)==null||i.push(n),ke(d).then(a=>{const l=ye(a);try{Ae(w,r,l),Ie(w),t.phrase?De(w):Ue(w)}catch(u){console.error("Error collecting data:",u)}return l}).catch(a=>{throw console.error("Error fetching product search:",a),new Error("Error fetching product search.")}).finally(()=>{})}function We(){return ze().then(t=>Ee(t)).catch(t=>{throw console.error("Error fetching attribute metadata:",t),new Error("Error fetching attribute metadata.")}).finally(()=>{})}const j=(t,r)=>r?{text:t.positionLabel,value:"position_ASC"}:{text:t.relevanceLabel,value:"relevance_DESC"},je=(t,r,n)=>{const d=j(r,n),i=t.reduce((a,l)=>(l.attribute!=="position"&&l.attribute!=="relevance"&&(l.attribute==="price"?(a.push({text:r.sortASC,value:`${l.attribute}_ASC`}),a.push({text:r.sortDESC,value:`${l.attribute}_DESC`})):a.push({text:l.label,value:`${l.attribute}_DESC`})),a),[]);return i.push(d),{options:i,default:d}},U=t=>{const r=t.indexOf("_");return[{attribute:t.substring(0,r),direction:t.substring(r+1)==="ASC"?"ASC":"DESC"}]},Te=t=>t.length>0?`${t[0].attribute}_${t[0].direction}`:"",Qe=(t,r)=>{const n=t.findIndex(d=>d.value===r);return n>-1?t[n]:null},Ze=({header:t,productList:r,footer:n})=>N("div",{className:"product-discovery-product-list",children:[t&&o(p,{className:"product-discovery-product-list__header",node:t}),o("div",{className:"product-discovery-product-list__grid",children:r&&o(p,{node:r})}),n&&o(p,{className:"product-discovery-product-list__pagination",node:n})]}),Be=({alertMessage:t=""})=>o("div",{className:_(["product-discovery-search-alert-message__wrapper"]),children:o("div",{className:"product-discovery-search-alert-message__content",children:o(_e,{heading:t,type:"warning",icon:o(Pe,{source:$e,size:"24"}),onDismiss:void 0})})}),T={search:"q",search_query:"search_query",pagination:"p",sort:"product_list_order",page_size:"page_size"},k=t=>{const n=Q().get(t);return n||""},Q=()=>{const t=window.location.search;return new URLSearchParams(t)},Ke=t=>{const r=new URL(window.location.href),n=new URLSearchParams(r.searchParams);t===1?n.delete("p"):n.set("p",t.toString()),q(r.pathname,n)},Ge=t=>{const r=new URL(window.location.href),n=new URLSearchParams(r.searchParams);n.set("product_list_order",t),q(r.pathname,n)},Je=t=>{const r=new URL(window.location.href),n=new URLSearchParams(r.searchParams);n.set("q",t),q(r.pathname,n)},q=(t,r)=>{r.toString()===""?window.history.pushState({},"",`${t}`):window.history.pushState({},"",`${t}?${r.toString()}`)},O=t=>{var d;const r=Q(),n=[];for(const[i,a]of r.entries())if(t.includes(i)&&!Object.values(T).includes(i))if(a.includes("--")){const l=a.split("--"),u={attribute:i,range:{from:Number(l[0]),to:Number(l[1])}};n.push(u)}else{const l=n.findIndex(u=>u.attribute==i);if(l!==-1)(d=n[l].in)==null||d.push(a);else{const u={attribute:i,in:[a]};n.push(u)}}return n},Xe=t=>{const r=new URL(window.location.href),n=new URLSearchParams(r.searchParams);for(const d of r.searchParams.keys())Object.values(T).includes(d)||n.delete(d);t.forEach(d=>{const i=d.attribute;if(d.range){const a=d.range;k(i)?(n.delete(i),n.append(i,`${a.from}--${a.to}`)):n.append(i,`${a.from}--${a.to}`)}else{const a=d.in||[],l=n.getAll(i);a.map(u=>{l.includes(u)||n.append(i,u)})}}),q(r.pathname,n)},W=t=>new DOMParser().parseFromString(t,"text/html").documentElement.textContent,ut=({minQueryLength:t=3,slots:r,pageSize:n=12,routeProduct:d,categoryPath:i})=>{const a=Fe({sortLabel:"Search.PLP.SortDropdown.title",relevanceLabel:"Search.PLP.SortDropdown.relevanceLabel",sortASC:"Search.PLP.SortDropdown.sortASC",sortDESC:"Search.PLP.SortDropdown.sortDESC",minQueryLength:o(He,{id:"Search.PLP.Warning.minQueryLength",fields:{minQueryLength:t}}),noResults:"Search.PLP.Warning.noResults",searchError:"Search.PLP.Warning.searchError",positionLabel:"Search.PLP.SortDropdown.positionLabel"}),[l,u]=S([]),[A,Z]=S(),[B,K]=S(1),[G,L]=S(!1),[J,y]=S(a.noResults),I=j(a,i),[X,z]=S(),[Y,b]=S([]),V=[...Array(n).keys()].map(()=>{const e=xe({});return e.initialized=!1,e}),[E,ee]=S(V),F=e=>{qe(e.sku,w)},te=e=>{x({currentPage:e})},re=e=>{Z(e),Ke(e)},ne=e=>{const c=U(e);z(e),x({sort:c})},oe=e=>{var h;const c=k("product_list_order"),m=U(c||I.value),s={phrase:i?"":(e==null?void 0:e.phrase)||k("q"),pageSize:(e==null?void 0:e.pageSize)||n,currentPage:(e==null?void 0:e.currentPage)||A,filter:(e==null?void 0:e.filter)||O(Y),sort:(e==null?void 0:e.sort)||m};return(e!=null&&e.phrase||e!=null&&e.filter||e!=null&&e.sort||e!=null&&e.pageSize)&&(s.currentPage=1,e!=null&&e.phrase&&(s.filter=[],s.sort=U(I.value),z(I.value))),i?(s.phrase="",s.filter=(h=s.filter)==null?void 0:h.concat({attribute:"categoryPath",eq:i})):s.phrase=(e==null?void 0:e.phrase)||k("q")||"",s},ce=e=>{if(!i){const s=e.phrase||"";Je(s)}const c=e.filter||[];Xe(c);const m=Te(e.sort||[]);Ge(m)},se=e=>We().then(c=>{b(((c==null?void 0:c.filterableInSearch)||[]).map(f=>f.attribute));const m=je(c==null?void 0:c.sortable,a,i);u(m.options);const s=Qe(m.options,e||m.default.value);return z(s.value),O(((c==null?void 0:c.filterableInSearch)||[]).map(f=>f.attribute))}).catch(()=>{L(!0),y(a.searchError)}),x=e=>{var m;const c=oe(e);if(ce(c),!i&&(((m=c==null?void 0:c.phrase)==null?void 0:m.length)||0)<t)L(!0),y(a.minQueryLength.replace("{SEARCH_PHRASE}",(c==null?void 0:c.phrase)||"")),H();else return L(!1),Oe(c).then(s=>{var h,f;$.emit("search/result",{result:s,request:c}),(s==null?void 0:s.totalCount)===0&&(s==null?void 0:s.items.length)===0?(L(!0),y(a.noResults)):(ee(s==null?void 0:s.items.map(g=>(g.initialized=!0,g))),re(((h=s==null?void 0:s.pageInfo)==null?void 0:h.currentPage)||1),K(((f=s==null?void 0:s.pageInfo)==null?void 0:f.totalPages)||1))}).catch(()=>{L(!0),y(a.searchError),H()}).finally(()=>{})},ae=pe(e=>{x(e)},[]),H=()=>{$.emit("search/result",{result:{},request:{}})};ge(()=>{const e=k("q"),c=k("product_list_order")||I.value;se(c).then(s=>{i?x({filter:[{attribute:"categoryPath",eq:i}]}):e!=null&&e.length&&e.length<t?(L(!0),y(a.minQueryLength.replace("{SEARCH_PHRASE}",e)),H()):x({filter:s})});const m=$.on("search/request",ae);return()=>{m==null||m.off()}},[]);const ie=e=>o(C,{name:"ProductActions",slot:r==null?void 0:r.ProductActions,context:{product:e}}),de=e=>{var s,h,f,g,R;let c=e.typename==="ComplexProductView"?(s=e.priceRange)==null?void 0:s.minimum.regular.amount.currency:(h=e.price)==null?void 0:h.regular.amount.currency;Intl.supportedValuesOf("currency").indexOf(c||"")===-1&&(c="USD");const m=e.typename==="ComplexProductView"?o(v,{display:"from to",minimumAmount:(f=e.priceRange)==null?void 0:f.minimum.regular.amount.value,maximumAmount:(g=e.priceRange)==null?void 0:g.maximum.regular.amount.value,currency:c}):o(v,{amount:(R=e.price)==null?void 0:R.regular.amount.value,currency:c});return o(C,{name:"ProductPrice",slot:r==null?void 0:r.ProductPrice,context:{product:e},children:d?o("a",{href:d(e),onClick:()=>F(e),children:m}):m})},le=e=>{const c=e.name!==null?W(e.name):"";return o(C,{name:"ProductName",slot:r==null?void 0:r.ProductName,context:{product:e},children:d?o("a",{href:d(e),onClick:()=>F(e),children:c}):c})},me=(e,c)=>{var f,g,R,M;const m={loading:c<8?"eager":"lazy",src:((g=(f=e.images)==null?void 0:f[0])==null?void 0:g.url)||"",alt:((M=(R=e.images)==null?void 0:R[0])==null?void 0:M.label)||"",width:"200",height:"250"},s=e.name!==null?W(e.name):e.sku,h=o(Ce,{class:"product-discovery-product-item__image",...m,"aria-label":s});return o(C,{name:"ProductImage",slot:r==null?void 0:r.ProductImage,context:{product:e,defaultImageProps:m},children:d?o("a",{href:d(e),onClick:()=>F(e),children:h}):h})},ue=()=>o(C,{name:"Header",slot:r==null?void 0:r.Header,context:{productList:E},children:o(Le,{floatingLabel:a.sortLabel,options:l,value:X,required:!0,handleSelect:e=>{const{value:c}=e.target;ne(c)},"data-testid":"product-list-sort-by-picker"})}),he=()=>o(C,{name:"Footer",slot:r==null?void 0:r.Footer,context:{productList:E},children:o(we,{currentPage:A,totalPages:B,onChange:e=>{te(e)}})}),fe=o(Ze,{header:ue(),footer:he(),productList:E==null?void 0:E.map((e,c)=>o(ve,{image:me(e,c),titleNode:le(e),price:de(e),actionButton:ie(e),initialized:e.initialized},e.id||e.sku))});return o("div",{class:"product-discovery-product-list__container",children:G?o(Be,{alertMessage:J}):fe})};export{ut as ProductList,ut as default};
//# sourceMappingURL=ProductList.js.map
