/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as v,jsx as s,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import*as d from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as D}from"@dropins/tools/preact-compat.js";import{VComponent as L,classes as z,Slot as R}from"@dropins/tools/lib.js";import{Button as x,Icon as A,ActionButton as H,PriceRange as N,Divider as U,Checkbox as V,RadioButton as j}from"@dropins/tools/components.js";/* empty css                 */import{useText as $}from"@dropins/tools/i18n.js";/* empty css                   *//* empty css                      *//* empty css                   */import{events as M}from"@dropins/tools/event-bus.js";const P=e=>d.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},d.createElement("g",{id:"Large"},d.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),d.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},d.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),d.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),T=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 12H21",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 6H21",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 18H21",stroke:"currentColor"})),W=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),Y=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),G=({numberOfOptionsConfig:e=5,header:r,buckets:c})=>{const l=$({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),m=e,[h,g]=C(c.length<m),p=h?c.length:m;return v("div",{children:[s(L,{className:"product-discovery-facet__header",node:r}),c.slice(0,p).map((F,S)=>s(L,{className:"product-discovery-facet__bucket",node:F},S)),!h&&c.length>m&&s(x,{variant:"tertiary",icon:s(A,{source:P,size:"24"}),onClick:()=>g(!h),children:l.showMore}),h&&c.length>m&&s(x,{variant:"tertiary",icon:s(A,{source:Y,size:"24"}),onClick:()=>g(!h),children:l.showLess})]})},J=({selectedFacets:e,facets:r})=>{const[c,l]=C(!0),m=()=>{l(!c)};return v("div",{className:"product-discovery-facet-list",children:[s("div",{className:"product-discovery-facet-list__show-filters-button",children:v(H,{onClick:()=>{m()},children:[s(A,{source:T,size:"16"}),s("span",{children:"Filters"})]})}),s(L,{className:"product-discovery-facet-list__selected-filters",node:e}),s(L,{className:z(["product-discovery-facet-list__facet-options",["product-discovery-facet-list__facet-options--hidden",c]]),node:r})]})},K="no",Q="yes",X=e=>{const r=e.buckets.find(c=>c.selected);return r?{attribute:e.attribute,range:{from:r.from,to:r.to}}:null},Z=e=>{const r=e.buckets.reduce((c,l)=>(l.selected&&c.push(l.title),c),[]);return r.length===0?null:{attribute:e.attribute,in:r}},I=e=>{var r;switch((r=e.buckets[0])==null?void 0:r.__typename){case"RangeBucket":return X(e);case"ScalarBucket":case"CategoryView":return Z(e)}},ee=e=>{var c,l,m,h,g,p,F,S,y,B,_;const r=e[0];return(m=(l=(c=r==null?void 0:r.price)==null?void 0:c.regular)==null?void 0:l.amount)!=null&&m.currency?r.price.regular.amount.currency:(F=(p=(g=(h=r==null?void 0:r.priceRange)==null?void 0:h.minimum)==null?void 0:g.regular)==null?void 0:p.amount)!=null&&F.currency?(_=(B=(y=(S=r==null?void 0:r.priceRange)==null?void 0:S.minimum)==null?void 0:y.regular)==null?void 0:B.amount)==null?void 0:_.currency:"USD"},te=(e,r,c)=>(r==null?void 0:r.attribute)==="price"?e.from===0?v("div",{style:"display:flex",children:[s(N,{amount:e.from,currency:c||"USD"}),s("span",{style:"padding: 0 2px",children:"-"}),s(N,{amount:e.to,currency:c||"USD"})]}):s(N,{minimumAmount:e.from,maximumAmount:e.to,currency:c||"USD",display:"dash"}):e.title,re=(e,r)=>e.title===K?`Not ${r.title}`:e.title===Q?r.title:e.title,O=(e,r,c)=>{switch(e.__typename){case"RangeBucket":return te(e,r,c);case"ScalarBucket":case"CategoryView":return re(e,r)}},he=({slots:e})=>{const r=$({clearAll:"Search.Facet.clearAll"}),[c,l]=C([]),[m,h]=C(null),g=n=>{if(!n||!n.result.facets&&!n.result.items&&!n.request.filter){l([]);return}const{facets:a,items:u}=n.result;h(ee(u));const t=n.request.filter;if(a){const o=a.map(i=>{const f=i.buckets.map(w=>{w.selected=!1;const E=t==null?void 0:t.find(k=>k.attribute===i.attribute);if(E){const k=E.range;(k&&w.from===k.from&&w.to===k.to||E.in&&E.in.includes(w.title))&&(w.selected=!0)}return w});return i.buckets=f,i});l(o)}},p=n=>{const a=c.map(t=>{const o=n.find(i=>i.attribute===t.attribute);return o||t}),u=a.reduce((t,o)=>{const i=I(o);return i&&t.push(i),t},[]);l(a),M.emit("search/request",{filter:u})},F=(n,a)=>{const u=n.buckets.map(o=>(o.title===a&&(o.selected=!1),o)),t=n;t.buckets=u,p([t])},S=()=>{const n=c.map(a=>{const u=a.buckets.map(t=>(t.selected=!1,t));return a.buckets=u,a});l(n),M.emit("search/request",{filter:[]})},y=(n,a)=>{const u=a.buckets.map(o=>{var i;return((i=a.buckets[0])==null?void 0:i.__typename)==="RangeBucket"&&(o.selected=!1),o.title===n.target.value&&(o.selected=n.target.checked),o}),t=a;t.buckets=u,p([t])},B=n=>{const a=s("span",{children:n.title}),u=n.buckets.map(t=>{var i;const o=O(t,n,m);switch((i=n.buckets[0])==null?void 0:i.__typename){case"RangeBucket":return s(j,{"data-testid":`${t.title}-radio`,label:o,name:n.attribute,value:t.title,checked:t.selected,onChange:f=>{y(f,n)}});case"ScalarBucket":case"CategoryView":return s(V,{"data-testid":`${t.title}-checkbox`,label:`${o} (${t.count})`,name:n.attribute,value:t.title,checked:t.selected,onChange:f=>{y(f,n)}});default:return null}}).filter(t=>t!==null);return s(G,{header:a,buckets:u})},_=()=>s(R,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:c},children:c.map(n=>n.buckets.length>0?v(b,{children:[s(R,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:n},children:B(n)}),s(U,{variant:"secondary"})]}):null)}),q=()=>{const n=c.reduce((t,o)=>(o.buckets.filter(f=>f.selected).length>0&&t.push(o),t),[]),a=n.map(t=>t.buckets.map(o=>{if(o.selected){const i=O(o,t,m);return s(x,{"data-testid":`${o.title}-selected-btn`,"aria-label":`Remove ${t.title} filter: ${o.title}`,variant:"secondary",children:v(b,{children:[s("span",{children:i}),s(A,{source:W,size:"16"})]}),onClick:()=>{F(t,o.title)}})}return null})),u=a.length>0?s(x,{variant:"secondary",onClick:()=>{S()},children:s("span",{children:r.clearAll})}):null;return v(R,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:n},children:[a,u]})};return D(()=>{M.on("search/result",g)},[]),s(J,{selectedFacets:q(),facets:_()})};export{he as Facets,he as default};
//# sourceMappingURL=Facets.js.map
