/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as x}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as O,useCallback as o,useEffect as $,useMemo as B,useState as b}from"@dropins/tools/preact-compat.js";import{Image as Q,Price as U,Button as z}from"@dropins/tools/components.js";import{VComponent as _,Slot as k}from"@dropins/tools/lib.js";import{events as S}from"@dropins/tools/event-bus.js";/* empty css                   */import{s as H,S as M}from"../chunks/acdlEvents.js";import{useText as V}from"@dropins/tools/i18n.js";const C=({productList:c,viewAllButton:s,onClose:i,...r})=>{const n=c&&c.length>0,u=O(null),t=o(l=>{u.current&&!u.current.contains(l.target)&&(i==null||i())},[i]),h=o(l=>{l.key==="Escape"&&(i==null||i())},[i]);return $(()=>{if(n)return document.addEventListener("mousedown",t),document.addEventListener("keydown",h),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",h)}},[n,t,h]),n?a("div",{className:"product-discovery--search-bar-results",...r,children:a("div",{className:"product-discovery--search-bar-results__popover",ref:u,role:"region","aria-label":"Search results","aria-live":"polite",children:x("div",{className:"product-discovery--search-bar-results__outer-container",...r,children:[a("div",{className:"product-discovery--search-bar-results__grid",role:"list","aria-label":`${(c==null?void 0:c.length)||0} search results`,children:c==null?void 0:c.map((l,d)=>a("div",{role:"listitem",children:l},d))}),s&&a("div",{className:"product-discovery--search-bar-results__view-all-wrapper",children:a(_,{className:"product-discovery--search-bar-results__view-all-button",node:s})})]})})}):null},F=({productRouteSearch:c=t=>(t==null?void 0:t.url)||"",productItem:s,productImage:i,productName:r,productPrice:n,...u})=>{const t=B(()=>{const{name:l="",sku:d="",url:y=""}=s||{};return{tooltipText:[l,d&&`SKU: ${d}`].filter(Boolean).join(`
`),url:y}},[s]),h=l=>{H(l.sku,M)};return x("a",{className:"product-discovery--product-item",href:c(s),rel:"noopener noreferrer",title:t.tooltipText,onClick:()=>h(s),...u,children:[a("div",{className:"product-discovery--product-item__image",children:a(_,{node:i})}),x("div",{className:"product-discovery--product-item__details",children:[a(_,{node:r}),a(_,{node:n})]})]})},ee=({products:c=[],productRouteSearch:s=n=>(n==null?void 0:n.url)||"",routeSearch:i=()=>{},slots:r})=>{const[n,u]=b(c),[t,h]=b(""),[l,d]=b(c.length>0),y=V({viewAllButton:"Search.SearchInput.viewAllButton"}),N=o(({result:e=[],request:m={}})=>{const{phrase:v=""}=m;u(e),h(v),d(e.length>0&&v.length>0)},[]);$(()=>{const e=S.on("search-input/result",N);return()=>{e==null||e.off()}},[N]);const w=o(()=>{S.emit("search-input/result",{result:[],request:{phrase:""}}),d(!1)},[]),R=o(()=>{i&&i(t),S.emit("search/request",{phrase:t}),w()},[i,t,w]),E=o(e=>{var v,f,g,P;const m={loading:"lazy",src:((f=(v=e.images)==null?void 0:v[0])==null?void 0:f.url)||"",alt:((P=(g=e.images)==null?void 0:g[0])==null?void 0:P.label)||"",width:"165",height:"165"};return a(k,{name:"ProductImage",slot:r==null?void 0:r.ProductImage,context:{productItem:e,defaultImageProps:m},children:a(Q,{...m,"aria-label":e.sku})})},[r==null?void 0:r.ProductImage]),p=o(e=>a(k,{name:"ProductName",slot:r==null?void 0:r.ProductName,context:{productItem:e},children:(e==null?void 0:e.name)||""}),[r==null?void 0:r.ProductName]),A=o(e=>{var f,g,P,j,D;const{value:m,currency:v}=((g=(f=e==null?void 0:e.price)==null?void 0:f.final)==null?void 0:g.amount)||((D=(j=(P=e==null?void 0:e.priceRange)==null?void 0:P.minimum)==null?void 0:j.final)==null?void 0:D.amount)||{};return a(k,{name:"ProductPrice",slot:r==null?void 0:r.ProductPrice,context:{productItem:e},children:a(U,{amount:typeof m=="number"?m:void 0,currency:v})})},[r==null?void 0:r.ProductPrice]),T=o(e=>a(F,{productRouteSearch:s,productItem:e,productImage:E(e),productName:p(e),productPrice:A(e)}),[s,E,p,A]),q=B(()=>a(z,{variant:"tertiary",onClick:R,children:y.viewAllButton}),[y.viewAllButton,R]),K=B(()=>n==null?void 0:n.map(e=>T(e)),[n,T]);return!n.length||!l?null:a(C,{productList:K,viewAllButton:q,onClose:w})};export{ee as SearchBarResults,ee as default};
//# sourceMappingURL=SearchBarResults.js.map
