/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as p,jsxs as V}from"@dropins/tools/preact-jsx-runtime.js";import{h as E}from"../chunks/errors.js";import"@dropins/tools/lib.js";import{events as S}from"@dropins/tools/event-bus.js";import{h as N,g as U}from"../chunks/events.js";import{n as j}from"../chunks/values.js";import{s as w}from"../chunks/setBillingAddress.js";/* empty css                             */import{Skeleton as L,SkeletonRow as P,Checkbox as R,InLineAlert as W}from"@dropins/tools/components.js";import{W as y}from"../chunks/ConditionalWrapper.js";import{c as C}from"../chunks/classes.js";import{useText as x}from"@dropins/tools/i18n.js";import{useState as u,useRef as $,useCallback as m,useEffect as T}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/synchronizeCheckout.js";const q=()=>p(L,{className:"bill-to-shipping-address__skeleton","data-testid":"bill-to-shipping-skeleton",children:p(P,{size:"small",variant:"row"})}),F=({className:e,checked:r,disabled:t,error:l=null,onChange:o=()=>{},onDismissError:a=()=>{}})=>{const f=x({title:"Checkout.BillToShippingAddress.title"}),h=l!==null,g=k=>{const b=k.target;o==null||o(b.checked)};return V("div",{className:"checkout-bill-to-shipping-address",children:[p(R,{checked:r,className:C(["checkout-bill-to-shipping-address__checkbox",e]),"data-testid":"bill-to-shipping-checkbox",disabled:t,label:f.title,name:"checkout-bill-to-shipping-address__checkbox",onChange:g}),h&&p("div",{className:"checkout-bill-to-shipping-address__error","data-testid":"checkout-bill-to-shipping-address-alert",children:p(W,{heading:l,type:"error",variant:"primary",onDismiss:a})})]})},G=y(F,q);function H(e){var o;const r=(o=e.shippingAddresses)==null?void 0:o[0],t=!!e.billingAddress;return(r==null?void 0:r.sameAsBilling)??!t}const cs=({active:e=!0,autoSync:r=!0,onCartSyncError:t,onChange:l})=>{const[o,a]=u(null),[f,h]=u(!1),[g,k]=u(!1),[b,_]=u(!0),A=$(!1),I=E.value,{cartSyncError:B}=x({cartSyncError:"Checkout.BillToShippingAddress.cartSyncError"}),z=m(()=>{a(null)},[]),n=m(s=>{a(null),_(i=>i===s?i:(l==null||l(s),s)),j({isBillToShipping:s})},[l]),D=m(s=>{const i=s;n(i),!(!r||!i||!N())&&w({sameAsShipping:!0}).catch(c=>{n(!1),t==null||t({error:c}),t||a(B)})},[n,r,t,B]),d=m(s=>{const i=!s||(s==null?void 0:s.isEmpty),c=!!(s!=null&&s.isVirtual);if(i||c){k(c),n(!1),A.current=!1;return}A.current||(n(H(s)),A.current=!0)},[n]);return T(()=>{if(!e)return;const s=U();if(s){h(!0),d(s);return}const i=S.on("checkout/initialized",c=>{h(!0),d(c)},{eager:!0});return()=>{i==null||i.off()}},[e,d]),T(()=>{if(!e)return;const s=S.on("checkout/updated",d,{eager:!1});return()=>{s==null||s.off()}},[e,d]),p(G,{checked:b,disabled:I,error:o,initialized:f,visible:e&&!g,onChange:D,onDismissError:z})};export{cs as BillToShippingAddress,cs as default};
