/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as x,jsx as t}from"@dropins/tools/preact-jsx-runtime.js";import{h as X,s as Y}from"../chunks/errors.js";import{classes as L,VComponent as ee,Slot as B}from"@dropins/tools/lib.js";import{events as j}from"@dropins/tools/event-bus.js";import{i as te,h as ne,g as oe}from"../chunks/events.js";import{n as re,g as A}from"../chunks/values.js";import{s as ae}from"../chunks/setPaymentMethod.js";import{W as se}from"../chunks/ConditionalWrapper.js";/* empty css                      */import{Skeleton as ce,SkeletonRow as _,IllustratedMessage as ie,Icon as D,ProgressSpinner as le,InLineAlert as me,ToggleButton as de,RadioButton as ue}from"@dropins/tools/components.js";import{s as he}from"../chunks/dom.js";import*as T from"@dropins/tools/preact-compat.js";import{useRef as pe,useEffect as fe}from"@dropins/tools/preact-compat.js";import{useText as Z}from"@dropins/tools/i18n.js";import{useState as w,useCallback as P,useEffect as R,useMemo as ye}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/synchronizeCheckout.js";const ke=n=>T.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),ge=()=>x(ce,{"data-testid":"payment-methods-skeleton",children:[t(_,{size:"medium",variant:"heading"}),t(_,{size:"medium",variant:"empty"}),t(_,{fullWidth:!0,size:"xlarge"}),t(_,{fullWidth:!0,size:"xlarge"})]}),ve=({UIComponentType:n="ToggleButton",code:r,icon:c,onSelectionChange:y,selected:o,title:a})=>{const i={className:"checkout-payment-methods__method",label:a,name:"payment-method",value:r,onChange:()=>y({code:r,title:a})};return n==="ToggleButton"?t(de,{...i,icon:c?t(D,{source:c}):void 0,selected:o}):t(ue,{...i,checked:o,icon:c??void 0})},Se=({className:n,error:r=null,loading:c=!1,onDismissError:y,onSelectionChange:o=()=>{},options:a,paymentMethodContent:i,selection:g,title:k,UIComponentType:C})=>{const E=Z({EmptyState:"Checkout.PaymentMethods.emptyState"}),p=r!==null,v=pe(null);return fe(()=>{p&&v.current&&he(v.current)},[p]),x("div",{className:L(["checkout-payment-methods",n]),"data-testid":"checkout-payment-methods",children:[k&&t(ee,{className:"checkout-payment-methods__title",node:k}),!c&&a.length===0&&t(ie,{"data-testid":"checkout-payment-methods-empty",icon:t(D,{source:ke}),message:t("p",{children:E.EmptyState})}),x("div",{className:L(["checkout-payment-methods__wrapper",["checkout-payment-methods__wrapper--loading",c]]),children:[c&&t(le,{className:"checkout-payment-methods__spinner"}),t("div",{className:L(["checkout-payment-methods__methods",["checkout-payment-methods--full-width",a.length%2!==0]]),children:a==null?void 0:a.map(d=>t(ve,{UIComponentType:C,code:d.code,icon:d.icon,selected:(g==null?void 0:g.code)===d.code,title:d.displayLabel??!0?d.title:"",onSelectionChange:o},d.code))}),i&&t("div",{className:"checkout-payment-methods__content",children:i})]}),p&&t("div",{ref:v,className:"checkout-payment-methods__error","data-testid":"checkout-payment-methods-alert",children:t(me,{heading:r,type:"error",variant:"primary",onDismiss:y})})]})},Me=se(Se,ge);function Pe(n,r){return n?r.some(c=>c.code===n.code):!1}function Ce(n,r){return!n||!r?!1:n.code===r.code}function Ee(n){return n?!!n.code&&!!n.title:!1}const De=({UIComponentType:n="ToggleButton",active:r=!0,autoSync:c=!0,displayTitle:y=!0,slots:o,onCartSyncError:a,onSelectionChange:i})=>{var H,N;const[g,k]=w(null),[C,E]=w(!1),[p,v]=w(null),[d,W]=w([]),l=o==null?void 0:o.Methods,$=X.value,q=d.filter(e=>{var s;return((s=l==null?void 0:l[e.code])==null?void 0:s.enabled)!==!1}).map(e=>{const s=(l==null?void 0:l[e.code])||{};return{...e,...s}}),{cartSyncError:b,defaultTitle:z}=Z({cartSyncError:"Checkout.PaymentMethods.cartSyncError",defaultTitle:"Checkout.PaymentMethods.title"}),F=P(()=>{k(null)},[]),m=P(e=>{k(null),v(e),re({selectedPaymentMethod:e})},[]),S=P(async(e,s)=>{if(!(te()||ne()))return;const u=l==null?void 0:l[e.code];((u==null?void 0:u.autoSync)??c)&&ae({code:e.code}).catch(h=>{m(s??null),a==null||a({method:e,error:h}),a||k(b)})},[l,c,m,a,b]),G=P(async e=>{const s=A("selectedPaymentMethod");m(e),i==null||i(e),await S(e,s)},[i,m,S]),M=P(e=>{if(!e||e.isEmpty){m(null),W([]);return}const f=e.availablePaymentMethods??[];if(W(f),f.length===0){m(null);return}const u=e.selectedPaymentMethod??null,U=Ee(u),h=A("selectedPaymentMethod"),V=Pe(h,f),Q=Ce(h,u);if(h&&V&&!Q){S(h,u);return}if((!h||!V)&&U){m(u);return}if((!h||!V)&&!U){const O=f[0];m(O),S(O)}},[m,S]);R(()=>{if(!r)return;const e=oe();if(e){E(!0),M(e);return}const s=j.on("checkout/initialized",f=>{E(!0),M(f)},{eager:!0});return()=>{s==null||s.off()}},[r,M]),R(()=>{if(!r)return;const e=j.on("checkout/updated",M,{eager:!1});return()=>{e==null||e.off()}},[r,M]);const I=p?(N=(H=o==null?void 0:o.Methods)==null?void 0:H[p.code])==null?void 0:N.render:null,J=I?t(B,{context:{cartId:Y.cartId??"",replaceHTML(e){this.replaceWith(e)}},name:"PaymentMethodContent",slot:I},I):void 0,K=ye(()=>{if(y)return t(B,{name:"checkout-payment-methods-title",slot:o==null?void 0:o.Title,children:t("h2",{children:z})})},[y,o==null?void 0:o.Title,z]);return t(Me,{UIComponentType:n,error:g,initialized:C,loading:C&&$,options:q,paymentMethodContent:J,selection:p,title:K,visible:r,onDismissError:F,onSelectionChange:G})};export{De as PaymentMethods,De as default};
